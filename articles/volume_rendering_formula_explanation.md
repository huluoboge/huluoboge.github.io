---
title: "体积渲染"
date: 2025-09-19
tags: ["Markdown", "LaTeX", "3DGS"]
excerpt: "体积渲染公式详细解释"
---

# 体积渲染公式详细解释

## 公式分解

$$
C(r) = ∫ T(t) σ(r(t)) c(r(t), d) dt
$$
其中 $T(t) = exp(-∫ σ(r(s)) ds)$


## 1. 符号含义

### 输入参数
- **r**: 光线（ray），由起点和方向定义
- **r(t)**: 光线在参数t处的位置，r(t) = o + t·d
  - o: 光线起点（相机位置）
  - d: 光线方向（单位向量）
  - t: 沿光线的距离参数

### 场景函数
- **σ(r(t))**: 在位置r(t)处的体积密度（volume density）
  - 表示该位置物质的"浓稠程度"
  - 单位：1/长度（如1/m）
  - 决定光线被吸收或散射的概率

- **c(r(t), d)**: 在位置r(t)处沿方向d的辐射（radiance）
  - 表示该位置向特定方向发射的光线颜色
  - 通常是RGB向量

### 传输函数
- **T(t)**: 从光线起点到位置r(t)的透射率（transmittance）
  - 表示光线能够到达该位置而不被吸收的概率
  - 范围：[0, 1]，1表示完全透射，0表示完全吸收

## 2. 物理意义解释

### 透射率 T(t)
$$
T(t) = exp(-∫ σ(r(s)) ds)
$$


**物理意义**: 光线从起点传播到位置t时仍然存活的概率

**数学解释**:
- 指数函数表示累积吸收
- 积分∫ σ(r(s)) ds表示从0到t的累积光学深度
- 光学深度越大，透射率越小（指数衰减）

### 渲染方程 C(r)
$$
C(r) = ∫ T(t) σ(r(t)) c(r(t), d) dt
$$



**物理意义**: 相机沿光线r接收到的总辐射量

**分解理解**:
1. **σ(r(t)) c(r(t), d)**: 在位置r(t)处产生的辐射贡献
2. **T(t)**: 该辐射能够到达相机的概率
3. **积分∫ ... dt**: 累积整条光线上的所有贡献

## 3. 离散化实现

### 实际计算中的离散化
在实际NeRF实现中，连续积分被离散化为求和：

$$
Ĉ(r) = ∑ T_i (1 - exp(-σ_i δ_i)) c_i
$$
其中 $T_i = exp(-∑ σ_j δ_j)$


**离散化参数**:
- δ_i: 采样点之间的间隔
- i, j: 采样点索引

## 4. 具体计算步骤

### 步骤1: 光线采样
沿光线选择N个采样点：t₁, t₂, ..., tₙ

### 步骤2: 计算每个点的贡献
对于每个采样点i：
1. 查询密度 σ_i = σ(r(t_i))
2. 查询颜色 c_i = c(r(t_i), d)
3. 计算透射率 T_i = exp(-∑_{j=1}^{i-1} σ_j δ_j)
4. 计算该点贡献：T_i (1 - exp(-σ_i δ_i)) c_i

### 步骤3: 累积贡献
将所有采样点的贡献相加得到最终像素颜色。

## 5. 物理类比

### 类似于真实世界的现象
- **烟雾或雾**：密度σ表示烟雾浓度
- **透射率T**：表示能见度（透过烟雾能看到多少）
- **辐射c**：表示烟雾本身发出的光或被照亮的颜色

## 6. 数学特性

### 能量守恒
整个系统满足能量守恒：
- 透射率T(t)从1开始单调递减到0
- 总吸收量 + 总透射量 = 初始能量

### 可微分性
整个公式是可微分的，支持：
- 梯度反向传播
- 端到端优化
- 自动学习场景表示

## 7. 实际例子

### 简单场景：均匀雾
如果整个空间密度恒定σ₀，颜色恒定c₀：

$$
T(t) = exp(-σ₀ t)\\
C(r) = ∫ exp(-σ₀ t) σ₀ c₀ dt = c₀ (1 - exp(-σ₀ t_max))
$$


### 复杂场景：物体表面
在物体表面处：
- 密度σ突然增大
- 透射率T快速衰减
- 主要颜色贡献来自表面区域

## 8. 与传统渲染的关系

### 不同于表面渲染
传统渲染只考虑表面交点，而体积渲染：
- 考虑整个光线路径
- 能够表示半透明、参与介质
- 支持雾、烟、云等效果

### 与路径追踪的关系
体积渲染可以看作是简化的路径追踪，只考虑：
- 吸收（attenuation）
- 自发光（emission）
- 不考虑复杂的散射事件

## 9. 在NeRF中的应用

### 优化目标
通过最小化渲染误差来优化：
- 密度函数σ的参数
- 颜色函数c的参数
- 使渲染结果匹配训练图像

### 创新之处
NeRF的创新在于：
- 使用神经网络表示σ和c
- 通过可微分渲染进行优化
- 从多视图自动学习3D表示

这个公式是NeRF和许多体积渲染方法的核心，它 elegantly 地将物理渲染过程与可微分优化相结合。
