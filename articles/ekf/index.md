---
title: "卡尔曼滤波的推导"
date: 2025-12-04
tags: ["KF", "EKF","Kalman Filter​"， "Extended Kalman Filter"]
excerpt: "本文详细推导卡尔曼滤波算法"
draft: false
---


# 卡尔曼滤波算法详细理解


## **1. 状态是 x，控制输入 u


线性形式：

$$x_k = F_k x_{k-1} + B_k u_k + w_k$$

* $F$：状态转移
    
* $B u$：控制
    
* $w$：过程噪声
    

EKF 则是非线性版本：

$$x_k = f(x_{k-1}, u_k) + w_k$$

* * *

## **2. 有观测 z，可能是非线性的**

线性 KF：

$$z_k = H x_k + v_k$$

EKF：

$$z_k = h(x_k) + v_k$$

* * *

## **3. 目标是根据“预测状态 + 观测残差”来估计最优的 x**


卡尔曼滤波就是求最优线性无偏估计器（BLUE）。

融合两个信息：

* **预测：** 来自系统物理模型
    
* **观测：** 来自传感器测量
    

* * *

## **4. 融合时的权重 = 协方差的逆（信息矩阵）**

这是 KF 的本质：

* 协方差大 → 不确定度大 → 权重小
    
* 协方差小 → 不确定度小 → 权重大
    
可以认为KF的过程就是对预测和观测的加权融合（信息矩阵为权）

* * *

## **5. 预测阶段 = 根据控制传播 x 和 P**

x为状态，也就是需要估计未知数。 P为对应的协方差矩阵。


$$x_{k|k-1} = f(x_{k-1|k-1})$$ $$P_{k|k-1} = F P_{k-1|k-1} F^\top + Q$$

* 状态走一步
    
* 协方差随状态传播
    
* 加上过程噪声
    

协方差矩阵的更新叫 **不确定性的前向传播**。

* * *

## **6. 更新 = 根据观测残差来最小化误差**

这里是卡尔曼滤波算法的**核心**。
本质是：

> **找一个 x 的更新方式，使得估计误差的协方差最小。**

我们假设更新结构是：

$$x_{k|k} = x_{k|k-1} + K (z - h(x_{k|k-1}))$$

这里K就是卡尔曼增益， 第一项是预测的更新，第二项是观测残差。上面公式通俗理解就是有了预测的状态，有来观测到的残差，然后用卡尔曼增益根据观测到的残差来修正预测的状态。 

- **目标**
有了更新的结构， 下面需要估计上面方程最终状态的协方差矩阵P。最后，我们的目标是最小化协方差矩阵。上面公式观测是已知的， 预测也是已经计算好的， 唯一的变量是K。所以我们推导出协方差矩阵P以后，求使得P最小化的K，那么就可以得到最终的状态。 


比较幸运的是，协方差矩阵是一个二次型，所以只要求导数，然后令导数等于0，就可以得到K。我们暂时先忽略二次型的推导，先整体看一下卡尔曼滤波的过程。 

当前，KF 唯一要做的，就是：

### **对协方差 P 对 K 求导 = 0**

结果得到：

$$K = P H^\top (H P H^\top + R)^{-1}$$

就是卡尔曼增益。

这个增益刚好体现：

* $P$：预测的不确定性
    
* $R$：测量噪声
    
* $H$：测量模型
    
