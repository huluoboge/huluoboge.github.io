# 体积渲染公式的理解

在 NeRF 原论文中，体积渲染的核心思想是通过对光线上的体积密度和颜色进行积分，计算光线的最终颜色。以下是公式 1 到公式 3 的推导过程：

公式 1：光线颜色的积分公式
$$
C(r) = \int_{t_n}^{t_f} T(t) \sigma(r(t)) c(r(t), d) dt
$$
$( r(t) = o + td )$：光线的参数化表示，( o ) 是光线的起点，( d ) 是方向向量。
$( \sigma(r(t)) )$：体积密度，表示光线在位置 ( r(t) ) 处的吸收程度。
$( c(r(t), d) )$：光线在位置 ( r(t) ) 处的颜色。
$( T(t) = \exp\left(-\int_{t_n}^t \sigma(r(s)) ds\right) )$：累积透射率，表示光线从 ( t_n ) 到 ( t ) 没有被吸收的概率。
**公式 1 的物理意义**：光线的颜色是沿光线方向上所有点的颜色 $( c(r(t), d) )$ 的加权和，权重由体积密度 $( \sigma(r(t)) )$ 和累积透射率 $( T(t) )$ 决定。

**公式 3：离散化积分**

由于公式 1 是一个连续积分，无法直接计算，因此需要离散化。将积分区间 $ [t_n, t_f] $ 划分为 $N$ 个小区间，每个区间的长度为 $\delta_i = t_{i+1} - t_i$，可以近似为：

$ C(r) \approx \sum_{i=1}^N T_i \alpha_i c_i $

$ T_i = \prod_{j=1}^{i-1} (1 - \alpha_j) $：累积透射率，表示光线从 $ t_n $  到 $  t_i $  没有被吸收的概率。
$  \alpha_i = 1 - \exp(-\sigma_i \delta_i) $ ：每个区间的吸收概率，基于体积密度 $  \sigma_i $  和区间长度 $  \delta_i $ 。
$  c_i = c(r(t_i), d) $ ：光线在离散采样点 $ t_i $  处的颜色。
公式 3 的离散化使得积分可以通过有限个采样点的加权和来近似计算。

**最终的颜色合成公式**
$  C(r) = \sum_{i=1}^N T_i (1 - \exp(-\sigma_i \delta_i)) c_i $ 

$  T_i = \prod_{j=1}^{i-1} \exp(-\sigma_j \delta_j) $ ：累积透射率的展开形式。
$  1 - \exp(-\sigma_i \delta_i)$ ：每个采样点的权重（即吸收概率）。
公式 3 的意义是：光线的颜色是沿光线方向上所有采样点的颜色 ( c_i ) 的加权和，权重由体积密度 ( \sigma_i ) 和累积透射率 ( T_i ) 决定。

**总结**
公式 1 是连续形式的体积渲染公式，公式 3 是对公式 1 的离散化，直接给出了光线颜色的计算方法。通过离散化和分层采样，NeRF 可以高效地估计光线颜色，同时保持对场景的连续表示。